

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Virtual Cluster (in progress) &mdash; Cloudmesh 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
        <script src="_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
        <script src="https://unpkg.com/mermaid@8.4.8/dist/mermaid.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Batch" href="hpc/batch.html" />
    <link rel="prev" title="Cloudmesh Config File Encryption" href="configuration/encryption.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Cloudmesh
          

          
            
            <img src="_static/logo3.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                4.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">INTRODUCTION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="preface/index.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts/index.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="accounts/index.html">Cloud Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="viewer/index.html">Cloudmesh Viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks/index.html">Benchmarks</a></li>
</ul>
<p class="caption"><span class="caption-text">MANUAL PAGES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cmd5.html">cms</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual/all.html">Command List</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual-cmd5.html">Basic Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual-configuration.html">Configuration Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual-group.html">Group Command</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual-compute.html">Compute Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual-storage.html">Storage Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual-community.html">Community Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference-card.html">Reference Card</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">Cloudmesh Command API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html#cloudmesh-api">Cloudmesh API</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter/index.html">Jupyter Integration</a></li>
</ul>
<p class="caption"><span class="caption-text">COMMUNITY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="projects/index.html">Community Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev/index.html">Contributing</a></li>
</ul>
<p class="caption"><span class="caption-text">OTHER</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation/database/mongo-use.html">Developping with Mongo</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">To Do</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="deprecated.html">Deprecated</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="configuration/encryption.html">Cloudmesh Config File Encryption</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Virtual Cluster (in progress)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-virtual-cluster-and-testing-connections">Creating a Virtual Cluster and testing connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-runtime-configuration">Creating a runtime-configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-parallel-remote-jobs">Running Parallel Remote Jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cleaning-the-remote">Cleaning the remote</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hpc/batch.html">Batch</a></li>
<li class="toctree-l2"><a class="reference internal" href="hpc/refcard.html">HPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="workflow.html">Infrastructure Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="vm/vm.html">Virtual Machine Management</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cloudmesh</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="deprecated.html">Deprecated</a> &raquo;</li>
        
      <li>Virtual Cluster (in progress)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/vcluster.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="virtual-cluster-in-progress">
<h1>Virtual Cluster (in progress)<a class="headerlink" href="#virtual-cluster-in-progress" title="Permalink to this headline">Â¶</a></h1>
<p>This is a tool used to submit jobs to remote hosts in parallel and
contains the following subcommands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cms vcluster create virtual-cluster VIRTUALCLUSTER_NAME --clusters=CLUSTERS_LIST [--computers=COMPUTERS_LIST] [--debug]</span>
<span class="go">cms vcluster destroy virtual-cluster VIRTUALCLUSTER_NAME</span>
<span class="go">cms vcluster create runtime-config CONFIG_NAME PROCESS_NUM in:params out:stdout [--fetch-proc-num=FETCH_PROCESS_NUM [default=1]] [--download-now [default=True]]  [--debug]</span>
<span class="go">cms vcluster create runtime-config CONFIG_NAME PROCESS_NUM in:params out:file [--fetch-proc-num=FETCH_PROCESS_NUM [default=1]] [--download-now [default=True]]  [--debug]</span>
<span class="go">cms vcluster create runtime-config CONFIG_NAME PROCESS_NUM in:params+file out:stdout [--fetch-proc-num=FETCH_PROCESS_NUM [default=1]]  [--download-now [default=True]]  [--debug]</span>
<span class="go">cms vcluster create runtime-config CONFIG_NAME PROCESS_NUM in:params+file out:file [--fetch-proc-num=FETCH_PROCESS_NUM [default=1]] [--download-now [default=True]]  [--debug]</span>
<span class="go">cms vcluster create runtime-config CONFIG_NAME PROCESS_NUM in:params+file out:stdout+file [--fetch-proc-num=FETCH_PROCESS_NUM [default=1]] [--download-now [default=True]]  [--debug]</span>
<span class="go">cms vcluster set-param runtime-config CONFIG_NAME PARAMETER VALUE</span>
<span class="go">cms vcluster destroy runtime-config CONFIG_NAME</span>
<span class="go">cms vcluster list virtual-clusters [DEPTH [default:1]]</span>
<span class="go">cms vcluster list runtime-configs [DEPTH [default:1]]</span>
<span class="go">cms vcluster run-script --script-path=SCRIPT_PATH --job-name=JOB_NAME --vcluster-name=VIRTUALCLUSTER_NAME --config-name=CONFIG_NAME --arguments=SET_OF_PARAMS --remote-path=REMOTE_PATH&gt; --local-path=LOCAL_PATH [--argfile-path=ARGUMENT_FILE_PATH] [--outfile-name=OUTPUT_FILE_NAME] [--suffix=SUFFIX] [--overwrite]</span>
<span class="go">cms vcluster fetch JOB_NAME</span>
<span class="go">cms vcluster clean-remote JOB_NAME PROCESS_NUM</span>
<span class="go">cms vcluster test-connection VIRTUALCLUSTER_NAME PROCESS_NUM</span>
</pre></div>
</div>
<p>As can be seen, the command <code class="docutils literal notranslate"><span class="pre">vcluster</span></code> can be called with XX possible
options:</p>
<ul class="simple">
<li><p>create</p>
<ul>
<li><p>virtual-cluster</p></li>
<li><p>runtime-config</p></li>
</ul>
</li>
<li><p>destroy</p>
<ul>
<li><p>virtual-cluster</p></li>
<li><p>runtime-config</p></li>
</ul>
</li>
<li><p>list</p>
<ul>
<li><p>virtual-clusters</p></li>
<li><p>runtime-configs</p></li>
</ul>
</li>
<li><p>set-param</p>
<ul>
<li><p>virtual-cluster</p></li>
<li><p>runtime-config</p></li>
</ul>
</li>
<li><p>run-script</p></li>
<li><p>fetch</p></li>
<li><p>clean-remote</p></li>
<li><p>test-connection</p></li>
</ul>
<p>The information needed to create a virtual cluster, are extracted from
the <code class="docutils literal notranslate"><span class="pre">yaml</span></code> file of the cloudmesh v4, aka <code class="docutils literal notranslate"><span class="pre">cms</span></code>, however, it does not
modify that file. Instead, it will create a new configuration file in a
folder called <code class="docutils literal notranslate"><span class="pre">vcluster_workspace</span></code>. This newly generate configuration
file contains all the information about the virtual clusters, runtime
configurations as well as submitted jobs and therefore the file is
crucial for fetching the result of the previous runs. Although possible,
it is highly recommended not to modify the file directly but instead use
the <code class="docutils literal notranslate"><span class="pre">set-param</span></code> command to modify the file.</p>
<p>When you are creating a virtual cluster, you can <em>pick</em> your nodes of
interest from the cloudmesh configuration and just pass it as an
argument to <code class="docutils literal notranslate"><span class="pre">create</span> <span class="pre">virtual-cluster</span></code> and you will have your <em>Virtual
Cluster</em> created this way. When you are done with a Virtual Cluster, aka
<code class="docutils literal notranslate"><span class="pre">vcluster</span></code>, you can simply destroy it.</p>
<div class="section" id="creating-a-virtual-cluster-and-testing-connections">
<h2>Creating a Virtual Cluster and testing connections<a class="headerlink" href="#creating-a-virtual-cluster-and-testing-connections" title="Permalink to this headline">Â¶</a></h2>
<p>Consider the following two dummy clusters in the <code class="docutils literal notranslate"><span class="pre">cloudmesh.yaml</span></code>
file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cloudmesh</span><span class="p">:</span>
    <span class="o">...</span>
    <span class="n">vcluster_test1</span><span class="p">:</span>
      <span class="n">computer_a</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">machine1</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">one</span>
        <span class="n">address</span><span class="p">:</span> <span class="n">localhost</span>
        <span class="n">credentials</span><span class="p">:</span>
          <span class="n">sshconfigpath</span><span class="p">:</span> <span class="o">~/</span><span class="n">vms</span><span class="o">/</span><span class="n">ubuntu14</span><span class="o">/</span><span class="n">sshconfig1</span>
      <span class="n">computer_b</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span>                       <span class="n">computer_a</span>
        <span class="n">label</span><span class="p">:</span>                      <span class="n">one</span>
        <span class="n">address</span><span class="p">:</span>                    <span class="n">localhost</span>
        <span class="n">credentials</span><span class="p">:</span>
          <span class="n">username</span><span class="p">:</span>                 <span class="n">TBD</span>
          <span class="n">pulickey</span><span class="p">:</span>                 <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span>
    <span class="n">vcluster_test2</span><span class="p">:</span>
      <span class="n">c2</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">machine2</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">two</span>
        <span class="n">address</span><span class="p">:</span> <span class="n">localhost</span>
        <span class="n">credentials</span><span class="p">:</span>
          <span class="n">sshconfigpath</span><span class="p">:</span> <span class="o">~/</span><span class="n">vms</span><span class="o">/</span><span class="n">ubuntu14</span><span class="o">/</span><span class="n">sshconfig2</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Suppose you want to create a virtual cluster called <code class="docutils literal notranslate"><span class="pre">new_vcluster</span></code>
using <code class="docutils literal notranslate"><span class="pre">computer_a</span></code> from <code class="docutils literal notranslate"><span class="pre">vcluster_test1</span></code> and <code class="docutils literal notranslate"><span class="pre">c2</span></code> from
<code class="docutils literal notranslate"><span class="pre">vcluster_test2</span></code>. This can be achieved using the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster create virtual-cluster vcluster1 --clusters<span class="o">=</span>vcluster_test1,vcluster_test2 --computers<span class="o">=</span>computer_a,c2
<span class="go">Virtual cluster created/replaced successfully.</span>
</pre></div>
</div>
<p>This command will create the <code class="docutils literal notranslate"><span class="pre">vcluster.yaml</span></code> file in the
<code class="docutils literal notranslate"><span class="pre">vcluster_workspace</span></code> folder and will keep the information about the
virtual cluster in there. Now, we can get the information about the
virtual cluster that we just created:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster list virtual-clusters
<span class="go"> vcluster1:</span>
<span class="go">     computer_a</span>
<span class="go">     c2</span>
</pre></div>
</div>
<p>By passing a depth higher than one as an extra argument, you can get
more information about the virtual clusters:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster list virtual-clusters <span class="m">2</span>
<span class="go"> vcluster1:</span>
<span class="go">     computer_a:</span>
<span class="go">         name:</span>
<span class="go">             machine1</span>
<span class="go">         label:</span>
<span class="go">             one</span>
<span class="go">         address:</span>
<span class="go">             localhost</span>
<span class="go">         credentials:</span>
<span class="go">             sshconfigpath</span>
<span class="go">     c2:</span>
<span class="go">         name:</span>
<span class="go">             machine2</span>
<span class="go">         label:</span>
<span class="go">             two</span>
<span class="go">         address:</span>
<span class="go">             localhost</span>
<span class="go">         credentials:</span>
<span class="go">             sshconfigpath</span>
</pre></div>
</div>
<p>Now that the virtual cluster is created, we can test the connection to
the remote nodes. We will try that using 2 processes in parallel:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster test-connection vcluster1 <span class="m">2</span>
<span class="go">Node computer_a is accessible.</span>
<span class="go">Node c2 is accessible.</span>
</pre></div>
</div>
<p>The output indicates that both nodes in the <code class="docutils literal notranslate"><span class="pre">vcluster1</span></code> are
accessible. In case you did not need the <code class="docutils literal notranslate"><span class="pre">vcluster1</span></code> anymore, you can
easily remove it using:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster destroy virtual-cluster vcluster1
<span class="go">Virtual-cluster vcluster1 destroyed successfully.</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-runtime-configuration">
<h2>Creating a runtime-configuration<a class="headerlink" href="#creating-a-runtime-configuration" title="Permalink to this headline">Â¶</a></h2>
<p>Next, we have to create a <code class="docutils literal notranslate"><span class="pre">runtime-configuration</span></code> which defines the
type of input and output for possibly a set of jobs that are going to be
submitted later. In the next example we will create a runtime
configuration for jobs that we want to run remotely using 5 processes,
fetch their results using 3 processes and the script that we want to run
remotely takes just some parameter (which could be left empty for no
parameters), and the output of the script is going to be printed on the
standard output, and suppose we want to just submit the jobs for running
on remote nodes and download them later (hence the <code class="docutils literal notranslate"><span class="pre">--download-later</span></code>
flag):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster create runtime-config ParamInStdOut <span class="m">5</span> in:params out:stdout --fetch-proc-num<span class="o">=</span><span class="m">3</span> --download-later
<span class="go">Runtime-configuration created/replaced successfully.</span>
</pre></div>
</div>
<p>Letâs get the list of runtime configurations to make sure our
configuration is created as we expected:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster list runtime-configs <span class="m">2</span>
<span class="go"> ParamInStdOut:</span>
<span class="go">     proc_num:</span>
<span class="go">         5</span>
<span class="go">     download_proc_num:</span>
<span class="go">         1</span>
<span class="go">     download-later:</span>
<span class="go">         False</span>
<span class="go">     input-type:</span>
<span class="go">         params</span>
<span class="go">     output-type:</span>
<span class="go">         stdout</span>
</pre></div>
</div>
<p>Similar to the virtual cluster, you can remove a runtime-configuration
using the <code class="docutils literal notranslate"><span class="pre">destroy</span></code> sub-command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster destroy runtime-config ParamInStdOut
<span class="go">Runtime-configuration ParamInStdOut destroyed successfully.</span>
</pre></div>
</div>
</div>
<div class="section" id="running-parallel-remote-jobs">
<h2>Running Parallel Remote Jobs<a class="headerlink" href="#running-parallel-remote-jobs" title="Permalink to this headline">Â¶</a></h2>
<p>Now that we have both the virtual cluster and runtime configuration
ready, we can try to submit a batch job to our virtual cluster using
<code class="docutils literal notranslate"><span class="pre">cms</span> <span class="pre">vcluster</span> <span class="pre">run-script</span></code>. This is by far the most complicated
sub-command of the <code class="docutils literal notranslate"><span class="pre">vcluster</span></code>, however, the name of the arguments are
pretty clear and looking at the names you would be able to pretty much
find your way. In the next example, we submit the
<code class="docutils literal notranslate"><span class="pre">inf_script_stdin_stdout.sh</span></code> file to the nodes of <code class="docutils literal notranslate"><span class="pre">vcluster1</span></code> and
using the <code class="docutils literal notranslate"><span class="pre">ParamInStdOut</span></code> configuration we run 10 instance of that
script on the virtual cluster. This script will be copied and run on the
home directory of the remote nodes (<code class="docutils literal notranslate"><span class="pre">~/</span></code>). Note that even though the
remote path is set to home directory, for each job a folder with a
unique suffix will be created to avoid conflicts. Also, note that this
script does not take any argument, but we indicated 10 <code class="docutils literal notranslate"><span class="pre">_</span></code> separated
by commas as a meaningless argument. This will notify the tool that you
need 10 instances of this script to be executed:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster run-script --script-path<span class="o">=</span>./cm4/vcluster/sample_scripts/inf_script_stdin_stdout.sh --job-name<span class="o">=</span>TestJob1 --vcluster-name<span class="o">=</span>vcluster1 --config-name<span class="o">=</span>ParamInStdOut --arguments<span class="o">=</span>_,_,_,_,_,_,_,_,_,_ --remote-path<span class="o">=</span>~/ --local-path<span class="o">=</span>./cm4/vcluster/sample_output --overwrite
<span class="go">Remote Pid on c2: 10104</span>
<span class="go">Remote Pid on c2: 10109</span>
<span class="go">Remote Pid on c2: 10402</span>
<span class="go">Remote Pid on computer_a: 8973</span>
<span class="go">Remote Pid on computer_a: 8979</span>
<span class="go">Remote Pid on computer_a: 8983</span>
<span class="go">Remote Pid on computer_a: 9464</span>
<span class="go">Remote Pid on c2: 10884</span>
<span class="go">Remote Pid on c2: 10993</span>
<span class="go">Remote Pid on computer_a: 9592</span>
<span class="go">collecting results</span>
<span class="go">waiting for other results if any...</span>
<span class="go">Results collected from c2.</span>
<span class="go">Results collected from c2.</span>
<span class="go">Results collected from c2.</span>
<span class="go">Results collected from computer_a.</span>
<span class="go">Results collected from computer_a.</span>
<span class="go">Results collected from computer_a.</span>
<span class="go">Results collected from computer_a.</span>
<span class="go">Results collected from c2.</span>
<span class="go">Results collected from c2.</span>
<span class="go">Results collected from computer_a.</span>
<span class="go">waiting for other results if any...</span>
<span class="go">All of the remote results collected.</span>
</pre></div>
</div>
<p>As you can see all of the jobs were submitted (using 5 processes) and
results were collected afterwards (using 3 processes). We can check the
existence of the results:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ll ./cloudmesh-cloud/vcluster/sample_output/
<span class="go">total 48</span>
<span class="go">drwxr-xr-x 2 corriel 4096 Oct 31 22:12 ./</span>
<span class="go">drwxr-xr-x 8 corriel 4096 Oct 31 22:12 ../</span>
<span class="go">-rw-r--r-- 1 corriel  255 Oct 31 22:12 outputfile_0_20181031_22123465</span>
<span class="go">-rw-r--r-- 1 corriel  255 Oct 31 22:12 outputfile_1_20181031_22123465</span>
<span class="go">-rw-r--r-- 1 corriel  255 Oct 31 22:12 outputfile_2_20181031_22123465</span>
<span class="go">-rw-r--r-- 1 corriel  255 Oct 31 22:12 outputfile_3_20181031_22123465</span>
<span class="go">-rw-r--r-- 1 corriel  255 Oct 31 22:12 outputfile_4_20181031_22123465</span>
<span class="go">-rw-r--r-- 1 corriel  255 Oct 31 22:12 outputfile_5_20181031_22123465</span>
<span class="go">-rw-r--r-- 1 corriel  255 Oct 31 22:12 outputfile_6_20181031_22123465</span>
<span class="go">-rw-r--r-- 1 corriel  255 Oct 31 22:12 outputfile_7_20181031_22123465</span>
<span class="go">-rw-r--r-- 1 corriel  255 Oct 31 22:12 outputfile_8_20181031_22123465</span>
<span class="go">-rw-r--r-- 1 corriel  255 Oct 31 22:12 outputfile_9_20181031_22123465</span>
</pre></div>
</div>
<p>Now, suppose the jobs were going to take so long that we could not wait
for the results and we had to download them later. To prepare this
scenario, we can set the <code class="docutils literal notranslate"><span class="pre">download-later</span></code> attribute of the runtime
configuration to <code class="docutils literal notranslate"><span class="pre">true</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster set-param runtime-config ParamInStdOut download-later <span class="nb">true</span>
<span class="go">Runtime-configuration parameter download-later set to true successfully.</span>
</pre></div>
</div>
<p>Now that we set this parameter, we can submit the jobs and this time the
tool will not wait for the results:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster run-script --script-path<span class="o">=</span>./cloudmesh-cloud/vcluster/sample_scripts/inf_script_stdin_stdout.sh --job-name<span class="o">=</span>TestJob1 --vcluster-name<span class="o">=</span>vcluster1 --config-name<span class="o">=</span>ParamInStdOut --arguments<span class="o">=</span>_,_,_,_,_,_,_,_,_,_ --remote-path<span class="o">=</span>~/ --local-path<span class="o">=</span>./cloudmesh-cloud/vcluster/sample_output --overwrite
<span class="go">Remote Pid on c2: 12981</span>
<span class="go">Remote Pid on c2: 12987</span>
<span class="go">Remote Pid on c2: 13280</span>
<span class="go">Remote Pid on computer_a: 11858</span>
<span class="go">Remote Pid on computer_a: 11942</span>
<span class="go">Remote Pid on computer_a: 11945</span>
<span class="go">Remote Pid on computer_a: 12300</span>
<span class="go">Remote Pid on c2: 13795</span>
<span class="go">Remote Pid on computer_a: 12427</span>
<span class="go">Remote Pid on c2: 13871</span>
</pre></div>
</div>
<p>As you can see, the jobs are submitted and the script is finished. Note
that since a job with that exact job name exists, you cannot submit the
job unless you use the <code class="docutils literal notranslate"><span class="pre">--overwrite</span></code> flag. Now that we have submitted
the jobs and their results are ready, we can fetch their produced
results using the <code class="docutils literal notranslate"><span class="pre">fetch</span></code> command and all results will be collected
using the same number of processes that were indicated in the
runtime-configuration using which the job was submitted in the first
place:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster fetch TestJob1
<span class="go">collecting results</span>
<span class="go">Results collected from c2.</span>
<span class="go">Results collected from c2.</span>
<span class="go">Results collected from c2.</span>
<span class="go">Results collected from computer_a.</span>
<span class="go">Results collected from computer_a.</span>
<span class="go">Results collected from computer_a.</span>
<span class="go">Results collected from c2.</span>
<span class="go">Results collected from computer_a.</span>
<span class="go">Results collected from computer_a.</span>
<span class="go">Results collected from c2.</span>
<span class="go">waiting for other results if any...</span>
<span class="go">All of the remote results collected.</span>
</pre></div>
</div>
</div>
<div class="section" id="cleaning-the-remote">
<h2>Cleaning the remote<a class="headerlink" href="#cleaning-the-remote" title="Permalink to this headline">Â¶</a></h2>
<p>By default the Virtual Cluster tool does not clean the remotes
automatically and this task is left to be performed manually since
important results might be lose due to mistakes. To clean the remotes,
the user has to explicitly use the <code class="docutils literal notranslate"><span class="pre">clean-remote</span></code> command for a
specific job and this way only the results of that particular job will
be removed from <strong>ALL</strong> remotes using 2 parallel processes:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> cms vcluster clean-remote TestJob1 <span class="m">4</span>
<span class="go">Node c2 cleaned successfully.</span>
<span class="go">Node computer_a cleaned successfully.</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hpc/batch.html" class="btn btn-neutral float-right" title="Batch" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="configuration/encryption.html" class="btn btn-neutral float-left" title="Cloudmesh Config File Encryption" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2010-2020, Gregor von Laszewski

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>